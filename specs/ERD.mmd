erDiagram
    USERS ||--o{ PROFILES : has
    USERS ||--o| PROVIDERS : "can be"
    USERS ||--o{ BOOKINGS : "customer in"
    USERS ||--o{ REVIEWS : writes
    USERS ||--o{ SAVED_PROVIDERS : saves
    USERS ||--o{ PAYMENT_METHODS : has
    
    PROFILES {
        uuid id PK
        uuid user_id FK "References USERS"
        string email
        string first_name
        string last_name
        string phone_number
        string avatar_url
        timestamp email_verified_at
        timestamp created_at
        timestamp updated_at
    }
    
    PROVIDERS ||--o{ SERVICES : offers
    PROVIDERS ||--o{ AVAILABILITY_RULES : defines
    PROVIDERS ||--o{ BLOCKED_SLOTS : blocks
    PROVIDERS ||--o{ BOOKINGS : "provider in"
    PROVIDERS ||--o{ REVIEWS : receives
    PROVIDERS ||--o{ PROVIDER_IMAGES : has
    PROVIDERS ||--o{ TESTIMONIALS : displays
    PROVIDERS ||--o{ PROVIDER_PAYOUTS : receives
    
    PROVIDERS {
        uuid id PK
        uuid user_id FK "References USERS"
        string slug "Unique URL identifier"
        string display_name
        string tagline
        text bio
        string cover_image_url
        string profile_image_url
        string location_city
        string location_state
        string location_country
        decimal lat
        decimal lng
        integer hourly_rate
        string currency
        integer years_experience
        boolean is_verified
        boolean is_active
        boolean is_featured
        string stripe_connect_account_id
        boolean stripe_onboarding_complete
        decimal commission_rate
        integer response_time_hours
        decimal completion_rate
        timestamp verified_at
        timestamp created_at
        timestamp updated_at
    }
    
    SERVICES {
        uuid id PK
        uuid provider_id FK "References PROVIDERS"
        string name
        text description
        integer duration_minutes
        decimal price
        string currency
        boolean is_active
        integer max_attendees
        string category
        timestamp created_at
        timestamp updated_at
    }
    
    AVAILABILITY_RULES {
        uuid id PK
        uuid provider_id FK "References PROVIDERS"
        integer day_of_week "0-6"
        time start_time
        time end_time
        boolean is_active
        timestamp created_at
        timestamp updated_at
    }
    
    BLOCKED_SLOTS {
        uuid id PK
        uuid provider_id FK "References PROVIDERS"
        date blocked_date
        time start_time "Nullable for full day"
        time end_time "Nullable for full day"
        string reason
        boolean is_recurring
        string recurrence_pattern "RRULE format"
        timestamp created_at
    }
    
    BOOKINGS ||--|| SERVICES : "for service"
    BOOKINGS ||--o| REVIEWS : "can have"
    BOOKINGS ||--o{ BOOKING_MESSAGES : contains
    BOOKINGS ||--|| TRANSACTIONS : "has payment"
    
    BOOKINGS {
        uuid id PK
        uuid provider_id FK "References PROVIDERS"
        uuid customer_id FK "References USERS"
        uuid service_id FK "References SERVICES"
        date booking_date
        time start_time
        time end_time
        string status "draft|pending|confirmed|completed|cancelled|no_show"
        decimal service_price
        decimal platform_fee
        decimal provider_payout
        decimal total_amount
        string cancellation_reason
        timestamp cancelled_at
        uuid cancelled_by FK "References USERS"
        string customer_notes
        string provider_notes
        boolean is_recurring
        uuid recurring_booking_id FK "Self reference"
        timestamp confirmed_at
        timestamp completed_at
        timestamp created_at
        timestamp updated_at
    }
    
    BOOKING_MESSAGES {
        uuid id PK
        uuid booking_id FK "References BOOKINGS"
        uuid sender_id FK "References USERS"
        text message
        boolean is_read
        timestamp read_at
        timestamp created_at
    }
    
    REVIEWS {
        uuid id PK
        uuid booking_id FK "References BOOKINGS"
        uuid provider_id FK "References PROVIDERS"
        uuid customer_id FK "References USERS"
        integer rating "1-5"
        text review_text
        text provider_response
        boolean is_verified_booking
        boolean is_featured
        timestamp provider_responded_at
        timestamp created_at
        timestamp updated_at
    }
    
    SAVED_PROVIDERS {
        uuid id PK
        uuid user_id FK "References USERS"
        uuid provider_id FK "References PROVIDERS"
        timestamp created_at
    }
    
    PROVIDER_IMAGES {
        uuid id PK
        uuid provider_id FK "References PROVIDERS"
        string image_url
        string image_type "gallery|certification|verification"
        string caption
        integer display_order
        boolean is_active
        timestamp created_at
    }
    
    TESTIMONIALS {
        uuid id PK
        uuid provider_id FK "References PROVIDERS"
        string customer_name
        string customer_image_url
        text testimonial_text
        integer rating "1-5"
        boolean is_featured
        boolean is_verified
        timestamp service_date
        timestamp created_at
    }
    
    CATEGORIES ||--o{ SERVICES : contains
    CATEGORIES ||--o{ CATEGORY_SUGGESTIONS : "has suggestions"
    
    CATEGORIES {
        uuid id PK
        string name
        string slug
        text description
        string icon_name
        string parent_category_id FK "Self reference"
        integer display_order
        boolean is_active
        timestamp created_at
        timestamp updated_at
    }
    
    CATEGORY_SUGGESTIONS {
        uuid id PK
        uuid category_id FK "References CATEGORIES"
        string search_term
        integer weight
    }
    
    TRANSACTIONS ||--o{ TRANSACTION_EVENTS : "has events"
    
    TRANSACTIONS {
        uuid id PK
        uuid booking_id FK "References BOOKINGS"
        string stripe_payment_intent_id
        string stripe_charge_id
        string stripe_transfer_id
        string stripe_refund_id
        decimal amount
        decimal platform_fee
        decimal provider_payout
        decimal stripe_fee
        decimal net_platform_revenue
        string status "pending|processing|completed|failed|refunded|disputed"
        string failure_reason
        timestamp processed_at
        timestamp refunded_at
        timestamp created_at
        timestamp updated_at
    }
    
    TRANSACTION_EVENTS {
        uuid id PK
        uuid transaction_id FK "References TRANSACTIONS"
        string event_type "payment.created|payment.succeeded|payment.failed|transfer.created|refund.created"
        json event_data
        string stripe_event_id
        timestamp created_at
    }
    
    PROVIDER_PAYOUTS {
        uuid id PK
        uuid provider_id FK "References PROVIDERS"
        string stripe_payout_id
        decimal amount
        string currency
        string status "pending|in_transit|paid|failed|cancelled"
        date payout_date
        string bank_account_last4
        json line_items "Array of booking IDs and amounts"
        timestamp created_at
        timestamp updated_at
    }
    
    PAYMENT_METHODS {
        uuid id PK
        uuid user_id FK "References USERS"
        string stripe_payment_method_id
        string type "card|bank_account"
        string brand "visa|mastercard|amex|etc"
        string last4
        integer exp_month
        integer exp_year
        boolean is_default
        timestamp created_at
        timestamp updated_at
    }
    
    NOTIFICATIONS ||--|| USERS : "sent to"
    
    NOTIFICATIONS {
        uuid id PK
        uuid user_id FK "References USERS"
        string type "booking.confirmed|booking.cancelled|review.received|payout.completed"
        string title
        text message
        json data
        boolean is_read
        timestamp read_at
        string channel "email|push|in_app"
        timestamp sent_at
        timestamp created_at
    }
    
    AUDIT_LOG {
        uuid id PK
        uuid user_id FK "References USERS"
        string entity_type "booking|provider|transaction"
        uuid entity_id
        string action "create|update|delete"
        json before_data
        json after_data
        string ip_address
        string user_agent
        timestamp created_at
    }
    
    PLATFORM_SETTINGS {
        uuid id PK
        string key "Unique"
        json value
        string category "fees|limits|features"
        timestamp updated_at
    }
    
    FEATURED_PROVIDERS {
        uuid id PK
        uuid provider_id FK "References PROVIDERS"
        date start_date
        date end_date
        integer display_order
        string placement "homepage|category|search"
        decimal fee_paid
        timestamp created_at
    }
    
    SEARCH_LOGS {
        uuid id PK
        uuid user_id FK "References USERS"
        string query
        json filters
        integer results_count
        json clicked_results
        string session_id
        timestamp created_at
    }
    
    WAITLIST {
        uuid id PK
        uuid customer_id FK "References USERS"
        uuid provider_id FK "References PROVIDERS"
        uuid service_id FK "References SERVICES"
        date preferred_date
        string time_preference "morning|afternoon|evening|any"
        boolean is_notified
        timestamp notified_at
        timestamp created_at
    }